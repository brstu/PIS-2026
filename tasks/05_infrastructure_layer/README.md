# –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ ‚Ññ5. Infrastructure Layer (–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π —Å–ª–æ–π)

**–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞:** –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–∏—Å—Ç–µ–º  
**–¢–µ–º–∞:** –†–µ–∞–ª–∏–∑–∞—Ü–∏—è Repository, REST API, –ë–î

---

> üöß **–í–∞–∂–Ω–æ!** –≠—Ç–∞ –ª–∞–±–∞ **–ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç Lab #2-4**. –í—ã —Ä–µ–∞–ª–∏–∑—É–µ—Ç–µ **–∞–¥–∞–ø—Ç–µ—Ä—ã** –¥–ª—è –ø–æ—Ä—Ç–æ–≤, —Å–æ–∑–¥–∞–Ω–Ω—ã—Ö —Ä–∞–Ω–µ–µ.

---

## –¶–µ–ª—å —Ä–∞–±–æ—Ç—ã

–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å **–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π —Å–ª–æ–π** (Infrastructure Layer):
- **Repository** ‚Äî —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∞–≥—Ä–µ–≥–∞—Ç–æ–≤ –≤ PostgreSQL
- **REST Controller** ‚Äî HTTP API –¥–ª—è –∫–æ–º–∞–Ω–¥/–∑–∞–ø—Ä–æ—Å–æ–≤
- **Event Publisher** ‚Äî –ø—É–±–ª–∏–∫–∞—Ü–∏—è –¥–æ–º–µ–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π

---

## –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –æ–±—É—á–µ–Ω–∏—è

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —Ä–∞–±–æ—Ç—ã —Å—Ç—É–¥–µ–Ω—Ç –±—É–¥–µ—Ç:
- **–†–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å** –∏—Å—Ö–æ–¥—è—â–∏–µ –∞–¥–∞–ø—Ç–µ—Ä—ã (Repository)
- **–°–æ–∑–¥–∞–≤–∞—Ç—å** –≤—Ö–æ–¥—è—â–∏–µ –∞–¥–∞–ø—Ç–µ—Ä—ã (REST Controller)
- **–ù–∞—Å—Ç—Ä–∞–∏–≤–∞—Ç—å** ORM (SQLAlchemy), –º–∏–≥—Ä–∞—Ü–∏–∏ (Alembic)
- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å** –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é —Å –ë–î (testcontainers)

---

## –ó–∞–¥–∞–Ω–∏–µ

### –ß–∞—Å—Ç—å 1. Repository (–ò—Å—Ö–æ–¥—è—â–∏–π –∞–¥–∞–ø—Ç–µ—Ä)

–†–µ–∞–ª–∏–∑—É–π—Ç–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `RequestRepository` (–∏–∑ Lab #2) —Å **PostgreSQL**.

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –∏–∑ `application.port.out`
- ORM-–º–∞–ø–ø–∏–Ω–≥ (SQLAlchemy)
- –ú–µ—Ç–æ–¥—ã: `save()`, `find_by_id()`, `find_active_requests()`

üìñ **–ü—Ä–∏–º–µ—Ä:** [examples/infrastructure/adapter/out/request_repository_impl.py](examples/infrastructure/adapter/out/request_repository_impl.py)

---

### –ß–∞—Å—Ç—å 2. REST Controller (–í—Ö–æ–¥—è—â–∏–π –∞–¥–∞–ø—Ç–µ—Ä)

–°–æ–∑–¥–∞–π—Ç–µ HTTP API –¥–ª—è –∫–æ–º–∞–Ω–¥ –∏ –∑–∞–ø—Ä–æ—Å–æ–≤.

**–≠–Ω–¥–ø–æ–∏–Ω—Ç—ã:**
- `POST /api/requests` ‚Äî —Å–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É
- `POST /api/requests/{id}/assign-group` ‚Äî –Ω–∞–∑–Ω–∞—á–∏—Ç—å –≥—Ä—É–ø–ø—É
- `GET /api/requests/{id}` ‚Äî –ø–æ–ª—É—á–∏—Ç—å –∑–∞—è–≤–∫—É
- `GET /api/requests` ‚Äî —Å–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞—è–≤–æ–∫

üìñ **–ü—Ä–∏–º–µ—Ä:** [examples/infrastructure/adapter/in/request_controller.py](examples/infrastructure/adapter/in/request_controller.py)

---

### –ß–∞—Å—Ç—å 3. –ë–î –∏ –º–∏–≥—Ä–∞—Ü–∏–∏

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞ PostgreSQL:**
- Docker Compose –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
- –ú–∏–≥—Ä–∞—Ü–∏–∏ Alembic

üìñ **–ü—Ä–∏–º–µ—Ä:** [examples/docker-compose.yml](examples/docker-compose.yml)

---

<!-- START:artifacts -->
## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç—á—ë—Ç–∞

üìÑ **[–ú–∞–∫–µ—Ç –æ—Ç—á—ë—Ç–∞ ‚Üí](–ú–∞–∫–µ—Ç_–æ—Ç—á–µ—Ç–∞.md)**

```
lab-05/
‚îú‚îÄ‚îÄ –û—Ç—á–µ—Ç.md
‚îú‚îÄ‚îÄ infrastructure/
‚îÇ   ‚îú‚îÄ‚îÄ adapter/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ in/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ request_controller.py     # FastAPI
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ out/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ request_repository.py      # SQLAlchemy
‚îÇ   ‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ database.py                   # DB connection
‚îÇ   ‚îî‚îÄ‚îÄ migrations/                       # Alembic
‚îÇ       ‚îî‚îÄ‚îÄ versions/
‚îú‚îÄ‚îÄ docker-compose.yml
‚îî‚îÄ‚îÄ tests/
    ‚îî‚îÄ‚îÄ test_integration.py
```
<!-- END:artifacts -->

<!-- START:criteria -->
## –ö—Ä–∏—Ç–µ—Ä–∏–∏ –æ—Ü–µ–Ω–∫–∏

| –ö—Ä–∏—Ç–µ—Ä–∏–π | –ë–∞–ª–ª—ã | –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è |
|----------|-------|------------|
| Repository: —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞, ORM | 25 | SQLAlchemy, –º–µ—Ç–æ–¥—ã save/find |
| REST Controller: CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏ | 25 | POST/GET endpoints, JSON |
| –ë–î: –º–∏–≥—Ä–∞—Ü–∏–∏, Docker Compose | 15 | Alembic, PostgreSQL |
| Event Publisher: –ø—É–±–ª–∏–∫–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π | 15 | In-memory –∏–ª–∏ Kafka |
| –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã: testcontainers | 15 | –¢–µ—Å—Ç—ã —Å —Ä–µ–∞–ª—å–Ω–æ–π –ë–î |
| –ö–∞—á–µ—Å—Ç–≤–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ | 5 | README, OpenAPI |
| **–ò–¢–û–ì–û** | **100** | |
<!-- END:criteria -->

<!-- START:bonuses -->
## –ë–æ–Ω—É—Å—ã (+ –¥–æ 15)

* **Docker Compose –¥–ª—è –≤—Å–µ–π —Å–∏—Å—Ç–µ–º—ã** (+5) ‚Äî app + db + migrations
* **OpenAPI Swagger UI** (+4) ‚Äî –∞–≤—Ç–æ–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API
* **Health Check endpoint** (+3) ‚Äî `/health` —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –ë–î
* **CORS configuration** (+3) ‚Äî –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞
<!-- END:bonuses -->

## –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã –¥–ª—è –∑–∞—â–∏—Ç—ã

1. **–ü–æ—á–µ–º—É Repository –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ Infrastructure, –∞ –Ω–µ –≤ Domain?**
2. **–í —á—ë–º –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ ORM –Ω–∞–¥ –æ–±—ã—á–Ω—ã–º SQL?**
3. **–ó–∞—á–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –≤–º–µ—Å—Ç–æ —Ä—É—á–Ω–æ–≥–æ CREATE TABLE?**
4. **–ö–∞–∫ testcontainers —É–ø—Ä–æ—â–∞–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ?**
5. **–ü–æ—á–µ–º—É REST Controller –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç –Ω–∞–ø—Ä—è–º—É—é –¥–æ–º–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏?**

---

## –ü–æ–ª–µ–∑–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [SQLAlchemy ORM](https://docs.sqlalchemy.org/en/20/orm/)
- [Alembic Migrations](https://alembic.sqlalchemy.org/en/latest/)
- [FastAPI](https://fastapi.tiangolo.com/)
- [Testcontainers](https://testcontainers.com/)

---

## –°—Ä–æ–∫ —Å–¥–∞—á–∏

**–ù–µ–¥–µ–ª—è 10-11 —Å–µ–º–µ—Å—Ç—Ä–∞**  
–ó–∞—â–∏—Ç–∞: –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ä–∞–±–æ—Ç—ã API —á–µ—Ä–µ–∑ Postman/Swagger
