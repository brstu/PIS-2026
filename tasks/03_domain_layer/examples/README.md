# –ü—Ä–∏–º–µ—Ä—ã –¥–ª—è –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π —Ä–∞–±–æ—Ç—ã ‚Ññ3 ‚Äî Domain Layer

**–ü—Ä–µ–¥–º–µ—Ç–Ω–∞—è –æ–±–ª–∞—Å—Ç—å:** –ü–æ–∏—Å–∫–æ–≤–æ-—Å–ø–∞—Å–∞—Ç–µ–ª—å–Ω—ã–π –æ—Ç—Ä—è–¥ ¬´–Æ–≥–æ-–ó–∞–ø–∞–¥¬ª (–ü–°–û)

---

## üìã –û–ø–∏—Å–∞–Ω–∏–µ

–≠—Ç–æ—Ç –ø—Ä–∏–º–µ—Ä –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç **–ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—É—é –¥–æ–º–µ–Ω–Ω—É—é –º–æ–¥–µ–ª—å** –¥–ª—è Request Service –∏–∑ –ü–°–û ¬´–Æ–≥–æ-–ó–∞–ø–∞–¥¬ª —Å –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º —Ç–∞–∫—Ç–∏—á–µ—Å–∫–∏—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ DDD:
- **Entities** (Request, Group, Volunteer)
- **Value Objects** (Zone, PhoneNumber, RequestStatus)
- **Aggregate** (Request –∫–∞–∫ –∫–æ—Ä–µ–Ω—å)
- **–ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã** (–±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞)
- **–î–æ–º–µ–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è** (GroupAssignedToRequest, RequestActivated)

## üîÑ –°–≤—è–∑—å —Å Lab #2

–í Lab #2 –º—ã —Å–æ–∑–¥–∞–ª–∏ **—Å–∫–µ–ª–µ—Ç** –ø—Ä–æ–µ–∫—Ç–∞ —Å –ø—Ä–æ—Å—Ç—ã–º–∏ –∫–ª–∞—Å—Å–∞–º–∏:
```python
class Request:
    def __init__(self, request_id: str, ...):
        self.id = request_id
        # –ú–∏–Ω–∏–º—É–º –ª–æ–≥–∏–∫–∏
```

–í Lab #3 –º—ã **–Ω–∞–ø–æ–ª–Ω—è–µ–º** —Å–∫–µ–ª–µ—Ç –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–π –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–æ–π:
```python
class Request:
    def assign_group(self, group: Group) -> None:
        # –í–∞–ª–∏–¥–∞—Ü–∏—è
        if self._status != RequestStatus.DRAFT:
            raise ValueError(...)
        
        # –ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã
        if group.member_count < 3 or group.member_count > 5:
            raise ValueError(...)
        
        # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
        self._assigned_group = group
        
        #  –î–æ–º–µ–Ω–Ω–æ–µ —Å–æ–±—ã—Ç–∏–µ
        self._events.append(GroupAssignedToRequest(...))
```

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–∏–º–µ—Ä–∞

```
examples/
‚îú‚îÄ‚îÄ README.md                    # –≠—Ç–æ—Ç —Ñ–∞–π–ª
‚îú‚îÄ‚îÄ domain/                      # Domain Layer (–ø–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è)
‚îÇ   ‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ request.py           # Aggregate Root —Å –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ group.py             # Entity
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ volunteer.py         # Entity
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ zone.py              # Value Object
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ phone_number.py      # Value Object
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ request_status.py    # Enum Value Object
‚îÇ   ‚îú‚îÄ‚îÄ events/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ request_events.py    # –î–æ–º–µ–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ exceptions/
‚îÇ       ‚îî‚îÄ‚îÄ domain_exceptions.py # –î–æ–º–µ–Ω–Ω—ã–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è
‚îî‚îÄ‚îÄ tests/
    ‚îî‚îÄ‚îÄ test_request.py          # –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç–æ–≤
```

## üéØ –ö–ª—é—á–µ–≤—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏

### 1. Entity vs Value Object

**Entity** (Request, Group, Volunteer):
- ‚úÖ –ò–º–µ–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID
- ‚úÖ –†–∞–≤–µ–Ω—Å—Ç–≤–æ –ø–æ ID
- ‚úÖ –ú–æ–∂–µ—Ç –∏–∑–º–µ–Ω—è—Ç—å—Å—è (mutable)
- ‚úÖ –ë–∏–∑–Ω–µ—Å-–º–µ—Ç–æ–¥—ã

**Value Object** (Zone, PhoneNumber):
- ‚úÖ –ù–ï–¢ ID (–∏–¥–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç—Å—è –∑–Ω–∞—á–µ–Ω–∏—è–º–∏)
- ‚úÖ –†–∞–≤–µ–Ω—Å—Ç–≤–æ –ø–æ –≤—Å–µ–º –ø–æ–ª—è–º
- ‚úÖ –ò–º–º—É—Ç–∞–±–µ–ª—å–Ω—ã–π (frozen)
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ

### 2. Aggregate Root (Request)

**Request** ‚Äî –∫–æ—Ä–µ–Ω—å –∞–≥—Ä–µ–≥–∞—Ç–∞:
- –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –≤ –∞–≥—Ä–µ–≥–∞—Ç
- –ó–∞—â–∏—â–∞–µ—Ç –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã (–±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞)
- –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç –¥–æ–º–µ–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è
- –£–ø—Ä–∞–≤–ª—è–µ—Ç –∑–∞–≤–∏—Å–∏–º—ã–º–∏ —Å—É—â–Ω–æ—Å—Ç—è–º–∏ (Group)

**–ì—Ä–∞–Ω–∏—Ü—ã –∞–≥—Ä–µ–≥–∞—Ç–∞**:
- –í–Ω—É—Ç—Ä–∏: Request (root) + assigned Group
- –°–Ω–∞—Ä—É–∂–∏: Volunteer, Coordinator (–∂–∏–≤—É—Ç –æ—Ç–¥–µ–ª—å–Ω–æ)

### 3. –ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã (–±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞)

| –ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç | –ì–¥–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è | –ò—Å–∫–ª—é—á–µ–Ω–∏–µ |
|-----------|-----------------|------------|
| –ì—Ä—É–ø–ø–∞ 3-5 —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ | `assign_group()` | ValueError |
| –ù–µ–ª—å–∑—è –Ω–∞–∑–Ω–∞—á–∏—Ç—å –≥—Ä—É–ø–ø—É –Ω–µ –≤ DRAFT | `assign_group()` | ValueError |
| –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ —Å –≥—Ä—É–ø–ø–æ–π | `activate()` | ValueError |
| –ù–µ–ª—å–∑—è –∏–∑–º–µ–Ω–∏—Ç—å –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—É—é –∑–∞—è–≤–∫—É | `change_zone()` | ValueError |

### 4. –î–æ–º–µ–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è

–°–æ–±—ã—Ç–∏—è —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è:
- `GroupAssignedToRequest` ‚Äî –∫–æ–≥–¥–∞ –≥—Ä—É–ø–ø–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∞
- `RequestActivated` ‚Äî –∫–æ–≥–¥–∞ –æ–ø–µ—Ä–∞—Ü–∏—è –Ω–∞—á–∞—Ç–∞
- `RequestZoneChanged` ‚Äî –∫–æ–≥–¥–∞ –∑–æ–Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∞
- `RequestCompleted` ‚Äî –∫–æ–≥–¥–∞ –æ–ø–µ—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞

**–ó–∞—á–µ–º –Ω—É–∂–Ω—ã —Å–æ–±—ã—Ç–∏—è?**
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è (–æ—Ç–ø—Ä–∞–≤–∏—Ç—å SMS —É—á–∞—Å—Ç–Ω–∏–∫–∞–º)
- –ê—É–¥–∏—Ç (–ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –∏—Å—Ç–æ—Ä–∏—é –∏–∑–º–µ–Ω–µ–Ω–∏–π)
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è (–∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å –≤ –¥—Ä—É–≥–æ–º —Å–µ—Ä–≤–∏—Å–µ)
- Event Sourcing (–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏–∑ —Å–æ–±—ã—Ç–∏–π)

## üöÄ –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–∏–º–µ—Ä

### 1. –ò–∑—É—á–∏—Ç–µ –¥–æ–º–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏

–ù–∞—á–Ω–∏—Ç–µ —Å –ø—Ä–æ—Å—Ç—ã—Ö Value Objects:
- [zone.py](domain/models/zone.py) ‚Äî –∑–æ–Ω–∞ —Å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏
- [phone_number.py](domain/models/phone_number.py) ‚Äî —Ç–µ–ª–µ—Ñ–æ–Ω —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π

–ó–∞—Ç–µ–º Entity:
- [group.py](domain/models/group.py) ‚Äî –≥—Ä—É–ø–ø–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
- [volunteer.py](domain/models/volunteer.py) ‚Äî –≤–æ–ª–æ–Ω—Ç—ë—Ä

–ò –∞–≥—Ä–µ–≥–∞—Ç:
- [request.py](domain/models/request.py) ‚Äî –∑–∞—è–≤–∫–∞ (–∫–æ—Ä–µ–Ω—å)

### 2. –ò–∑—É—á–∏—Ç–µ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã

–ö–∞–∂–¥—ã–π –±–∏–∑–Ω–µ—Å-–º–µ—Ç–æ–¥ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã:
```python
def assign_group(self, group: Group) -> None:
    # –ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç #1
    if self._status != RequestStatus.DRAFT:
        raise ValueError("–ù–µ–ª—å–∑—è –Ω–∞–∑–Ω–∞—á–∏—Ç—å –≥—Ä—É–ø–ø—É...")
    
    # –ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç #2
    if group.member_count < 3 or group.member_count > 5:
        raise ValueError("–ì—Ä—É–ø–ø–∞ –¥–æ–ª–∂–Ω–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç—å 3-5...")
```

### 3. –ò–∑—É—á–∏—Ç–µ –¥–æ–º–µ–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è

–°–æ–±—ã—Ç–∏—è —Å–æ–∑–¥–∞—é—Ç—Å—è –ø—Ä–∏ –≤–∞–∂–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö:
```python
self._events.append(GroupAssignedToRequest(
    request_id=self._id,
    group_id=group.id,
    occurred_at=datetime.now()
))
```

### 4. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Ç–µ—Å—Ç—ã

```bash
cd examples/
pytest tests/
```

–¢–µ—Å—Ç—ã –ø—Ä–æ–≤–µ—Ä—è—é—Ç:
- ‚úÖ –ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã (–Ω–µ–ª—å–∑—è –Ω–∞—Ä—É—à–∏—Ç—å –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞)
- ‚úÖ –î–æ–º–µ–Ω–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è (—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ)
- ‚úÖ Value Objects (–∏–º–º—É—Ç–∞–±–µ–ª—å–Ω–æ—Å—Ç—å, –≤–∞–ª–∏–¥–∞—Ü–∏—è)

## üîç –û—Ç–ª–∏—á–∏—è –æ—Ç Lab #2

| –ê—Å–ø–µ–∫—Ç | Lab #2 (–°–∫–µ–ª–µ—Ç) | Lab #3 (–ü–æ–ª–Ω–∞—è –º–æ–¥–µ–ª—å) |
|--------|-----------------|------------------------|
| –ú–æ–¥–µ–ª–∏ | –ü—Ä–æ—Å—Ç—ã–µ dataclasses | –ë–æ–≥–∞—Ç–∞—è –¥–æ–º–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å |
| –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ | –ü–æ—á—Ç–∏ –Ω–µ—Ç | –ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã + –≤–∞–ª–∏–¥–∞—Ü–∏—è |
| –°–æ–±—ã—Ç–∏—è | –ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã | –ü–æ–ª–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è |
| –¢–µ—Å—Ç—ã | –ù–µ —Ç—Ä–µ–±—É—é—Ç—Å—è | –Æ–Ω–∏—Ç-—Ç–µ—Å—Ç—ã –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã |
| –¶–µ–ª—å | –ü–æ–Ω—è—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É | –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ª–æ–≥–∏–∫—É |

## üí° –°–æ–≤–µ—Ç—ã –ø–æ –∞–¥–∞–ø—Ç–∞—Ü–∏–∏

–ß—Ç–æ–±—ã –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–º–µ—Ä –ø–æ–¥ —Å–≤–æ—é –ø—Ä–µ–¥–º–µ—Ç–Ω—É—é –æ–±–ª–∞—Å—Ç—å:

1. **–ó–∞–º–µ–Ω–∏—Ç–µ —Å—É—â–Ω–æ—Å—Ç–∏:**
   - Request ‚Üí Order/Booking/Task
   - Group ‚Üí Team/OrderItems
   - Zone ‚Üí Address/Category

2. **–û–ø—Ä–µ–¥–µ–ª–∏—Ç–µ —Å–≤–æ–∏ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã:**
   - –ö–∞–∫–∏–µ –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞ –Ω–µ–ª—å–∑—è –Ω–∞—Ä—É—à–∏—Ç—å?
   - –ö–æ–≥–¥–∞ –≤—ã–±—Ä–∞—Å—ã–≤–∞—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏—è?

3. **–°–æ–∑–¥–∞–π—Ç–µ —Å–≤–æ–∏ —Å–æ–±—ã—Ç–∏—è:**
   - –ß—Ç–æ –≤–∞–∂–Ω–æ –¥–ª—è –±–∏–∑–Ω–µ—Å–∞?
   - –ö–æ–≥–¥–∞ –Ω—É–∂–Ω—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è?

4. **–ù–∞–ø–∏—à–∏—Ç–µ —Ç–µ—Å—Ç—ã:**
   - –ö–∞–∂–¥—ã–π –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç = –º–∏–Ω–∏–º—É–º 1 —Ç–µ—Å—Ç
   - –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –≥—Ä–∞–Ω–∏—á–Ω—ã–µ —É—Å–ª–æ–≤–∏—è

## üìö –°–≤—è–∑—å —Å –¥—Ä—É–≥–∏–º–∏ –ª–∞–±–∞–º–∏

- **Lab #1**: Use-cases "–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏" ‚Üí `Request.assign_group()`
- **Lab #2**: –°–∫–µ–ª–µ—Ç –ø—Ä–æ–µ–∫—Ç–∞ ‚Üí –¢–µ–ø–µ—Ä—å –Ω–∞–ø–æ–ª–Ω–µ–Ω –ª–æ–≥–∏–∫–æ–π
- **Lab #4**: Application Layer –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–∏ –º–æ–¥–µ–ª–∏
- **Lab #5**: Infrastructure —Å–æ—Ö—Ä–∞–Ω–∏—Ç Request –≤ –ë–î
- **Lab #6**: –¢–µ—Å—Ç—ã –ø–æ–∫—Ä–æ—é—Ç –≤–µ—Å—å —Å—Ç–µ–∫
- **Lab #7**: Events ‚Üí Event Bus ‚Üí CQRS

## üéì –í–æ–ø—Ä–æ—Å—ã –¥–ª—è —Å–∞–º–æ–ø—Ä–æ–≤–µ—Ä–∫–∏

1. –ü–æ—á–µ–º—É `Zone` ‚Äî Value Object, –∞ `Group` ‚Äî Entity?
2. –ú–æ–∂–Ω–æ –ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å `PhoneNumber` –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è?
3. –ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥—ë—Ç –µ—Å–ª–∏ –ø–æ–ø—ã—Ç–∞—Ç—å—Å—è –Ω–∞–∑–Ω–∞—á–∏—Ç—å –≥—Ä—É–ø–ø—É —Å 2 —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏?
4. –ó–∞—á–µ–º —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ `GroupAssignedToRequest`?
5. –ì–¥–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã ‚Äî –≤ domain –∏–ª–∏ application?

**–û—Ç–≤–µ—Ç—ã –≤ –∫–æ–¥–µ!** üòâ
