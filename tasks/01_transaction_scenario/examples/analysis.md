# –ê–Ω–∞–ª–∏–∑ –≥—Ä–∞–Ω–∏—Ü –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏

**–°–∏—Å—Ç–µ–º–∞:** –ü–æ–∏—Å–∫–æ–≤–æ-—Å–ø–∞—Å–∞—Ç–µ–ª—å–Ω—ã–π –æ—Ç—Ä—è–¥ ¬´–Æ–≥–æ-–ó–∞–ø–∞–¥¬ª üî¶  
**–°—Ü–µ–Ω–∞—Ä–∏–π:** –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏ –Ω–∞ –ø–æ–∏—Å–∫ –∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã

---

## 1. –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—ã–µ –≥—Ä–∞–Ω–∏—Ü—ã

### 1.1. –ì–¥–µ –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è –∏ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è?

**–ù–∞—á–∞–ª–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:** –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä –Ω–∞–∂–∏–º–∞–µ—Ç –∫–Ω–æ–ø–∫—É "–°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É"

**–ö–æ–Ω–µ—Ü —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ (—É—Å–ø–µ—à–Ω—ã–π —Å—Ü–µ–Ω–∞—Ä–∏–π):**
- **–û—Å–Ω–æ–≤–Ω–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –ë–î ‚Ññ1:** –ó–∞—è–≤–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞ + –ó–æ–Ω—ã —Å–æ–∑–¥–∞–Ω—ã
- **–û—Å–Ω–æ–≤–Ω–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è –ë–î ‚Ññ2:** –ì—Ä—É–ø–ø–∞ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∞ + –ó–æ–Ω–∞ –Ω–∞–∑–Ω–∞—á–µ–Ω–∞ (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤)
- **–ü–æ–±–æ—á–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã (–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ):** SMS –∏ push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã —É—á–∞—Å—Ç–Ω–∏–∫–∞–º

**–í–∞–∂–Ω–æ:** –£ –Ω–∞—Å –¥–≤–µ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:
1. **–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏ + —Ä–∞–∑–±–∏–µ–Ω–∏–µ –Ω–∞ –∑–æ–Ω—ã** ‚Äî –∞—Ç–æ–º–∞—Ä–Ω–æ
2. **–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã + –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –Ω–∞ –∑–æ–Ω—É** ‚Äî –∞—Ç–æ–º–∞—Ä–Ω–æ (–Ω–æ –º–æ–∂–µ—Ç –æ—Ç–∫–∞—Ç–∏—Ç—å—Å—è –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –ø.1)

–ï—Å–ª–∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã –Ω–µ —É–¥–∞–ª–æ—Å—å, –∑–∞—è–≤–∫–∞ –æ—Å—Ç–∞—ë—Ç—Å—è –≤ —Å—Ç–∞—Ç—É—Å–µ `NEW`, –∏ –≥—Ä—É–ø–ø—É –º–æ–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –ø–æ–∑–∂–µ.

### 1.2. –ö–∞–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∞—Ç–æ–º–∞—Ä–Ω—ã–º–∏?

#### –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è ‚Ññ1: –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏

**–ê—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (–≤ –æ–¥–Ω–æ–π –ë–î-—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏):**
1. –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ Request –≤ —Ç–∞–±–ª–∏—Ü–µ `requests`
2. –í–∞–ª–∏–¥–∞—Ü–∏—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç —Ä–∞–π–æ–Ω–∞ (lat, lon, radius)
3. –í—ã–∑–æ–≤ —Å–µ—Ä–≤–∏—Å–∞ –≥–µ–æ–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è —Ä–∞–∑–±–∏–µ–Ω–∏—è –Ω–∞ –∑–æ–Ω—ã
4. –°–æ–∑–¥–∞–Ω–∏–µ 4 –∑–∞–ø–∏—Å–µ–π Zone –≤ —Ç–∞–±–ª–∏—Ü–µ `zones` (North, South, East, West)
5. –°–æ–∑–¥–∞–Ω–∏–µ —Å–≤—è–∑–∏ Request ‚Üî Zones

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:** –ó–∞—è–≤–∫–∞ –±–µ–∑ –∑–æ–Ω –Ω–µ –∏–º–µ–µ—Ç —Å–º—ã—Å–ª–∞. –ï—Å–ª–∏ —Ä–∞–∑–±–∏–µ–Ω–∏–µ –Ω–∞ –∑–æ–Ω—ã –Ω–µ —É–¥–∞–ª–æ—Å—å ‚Äî –∑–∞—è–≤–∫–∞ –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–∞.

**–ü—Ä–∏–º–µ—Ä —Å–±–æ—è:**
- –ï—Å–ª–∏ —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏ —É–¥–∞–ª–æ—Å—å, –Ω–æ –≥–µ–æ—Å–µ—Ä–≤–∏—Å –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É ‚Üí ROLLBACK –≤—Å–µ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- –ò–Ω–∞—á–µ –ø–æ–ª—É—á–∏–º "–∑–∞—è–≤–∫—É-–∑–æ–º–±–∏" –±–µ–∑ –∑–æ–Ω –¥–ª—è –ø–æ–∏—Å–∫–∞

#### –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏—è ‚Ññ2: –§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã

**–ê—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (–≤ –æ–¥–Ω–æ–π –ë–î-—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏):**
1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –≤–æ–ª–æ–Ω—Ç—ë—Ä–æ–≤ (—Å—Ç–∞—Ç—É—Å `AVAILABLE`)
2. –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ Group –≤ —Ç–∞–±–ª–∏—Ü–µ `groups`
3. –°–æ–∑–¥–∞–Ω–∏–µ —Å–≤—è–∑–µ–π Group ‚Üî Participants –≤ —Ç–∞–±–ª–∏—Ü–µ `group_members`
4. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ –≤–æ–ª–æ–Ω—Ç—ë—Ä–æ–≤ –Ω–∞ `BUSY`
5. –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –≥—Ä—É–ø–ø—ã –Ω–∞ –∑–æ–Ω—É (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ `zone.assigned_group_id`)
6. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–æ–Ω—ã –Ω–∞ `ASSIGNED`
7. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞—è–≤–∫–∏ –Ω–∞ `IN_PROGRESS`

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:** –ï—Å–ª–∏ –≤–æ–ª–æ–Ω—Ç—ë—Ä —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –∑–∞–Ω—è—Ç—ã–º, –Ω–æ –≥—Ä—É–ø–ø–∞ –Ω–µ —Å–æ–∑–¥–∞–ª–∞—Å—å ‚Üí –ø–æ–ª—É—á–∏–º "–∑–∞–≤–∏—Å—à–µ–≥–æ" –≤–æ–ª–æ–Ω—Ç—ë—Ä–∞.

### 1.3. –ö–∞–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–º–∏?

| –û–ø–µ—Ä–∞—Ü–∏—è | –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ |
|----------|-------------|
| –û—Ç–ø—Ä–∞–≤–∫–∞ SMS —Å—Ç–∞—Ä—à–µ–º—É –≥—Ä—É–ø–ø—ã | –ú–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç–ª–æ–∂–µ–Ω–∞. –ì—Ä—É–ø–ø–∞ —É–∂–µ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∞, SMS ‚Äî —ç—Ç–æ "best-effort" –¥–µ–π—Å—Ç–≤–∏–µ |
| –û—Ç–ø—Ä–∞–≤–∫–∞ push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤–æ–ª–æ–Ω—Ç—ë—Ä–∞–º | –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ SMS ‚Äî –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –≥—Ä—É–ø–ø—ã |
| –ó–∞–ø–∏—Å—å —Å–æ–±—ã—Ç–∏–π –≤ –∂—É—Ä–Ω–∞–ª —Å–æ–±—ã—Ç–∏–π (Events Log) | Eventual consistency –¥–æ–ø—É—Å—Ç–∏–º–∞. –°–æ–±—ã—Ç–∏—è –º–æ–∂–Ω–æ –∑–∞–ø–∏—Å–∞—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ —á–µ—Ä–µ–∑ event sourcing |
| –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –æ—Ç—Ä—è–¥–∞ (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞—è–≤–æ–∫) | –ú–æ–∂–Ω–æ –ø–µ—Ä–µ—Å—á–∏—Ç–∞—Ç—å –ø–æ–∑–∂–µ |
| –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å –∫–∞—Ä—Ç–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–∏–º —Å–µ—Ä–≤–∏—Å–æ–º (–æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∑–æ–Ω –Ω–∞ –∫–∞—Ä—Ç–µ) | –ù–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É |

**–ü—Ä–∏–Ω—Ü–∏–ø:** –ï—Å–ª–∏ –æ–ø–µ—Ä–∞—Ü–∏—è –ù–ï –Ω–∞—Ä—É—à–∞–µ—Ç –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã –¥–æ–º–µ–Ω–Ω–æ–π –º–æ–¥–µ–ª–∏ –ø—Ä–∏ –æ—Ç–∫–∞–∑–µ ‚Äî –æ–Ω–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–π.

---

## 2. –¢–∞–±–ª–∏—Ü–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—ã—Ö –≥—Ä–∞–Ω–∏—Ü

| –û–ø–µ—Ä–∞—Ü–∏—è | –°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è/–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è | –û—Ç–∫–∞—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ | Retry-—Å—Ç—Ä–∞—Ç–µ–≥–∏—è | –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å |
|----------|------------------------|------------------|-----------------|-----------------|
| **–í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–§–ò–û, –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã)** | –°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è | –ù–µ—Ç (–ø—Ä–æ—Å—Ç–æ –≤–æ–∑–≤—Ä–∞—Ç –æ—à–∏–±–∫–∏) | N/A | –î–∞ (—á—Ç–µ–Ω–∏–µ –±–µ–∑ side-effects) |
| **–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ Request –≤ –ë–î** | –°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è | –î–∞ (ROLLBACK —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ ‚Ññ1) | –ù–µ—Ç (–∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç—Å—è –ë–î) | –î–∞ (–ø—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–µ–π –ø–æ `idempotency_key`) |
| **–í—ã–∑–æ–≤ —Å–µ—Ä–≤–∏—Å–∞ –≥–µ–æ–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è (—Ä–∞–∑–±–∏–µ–Ω–∏–µ –Ω–∞ –∑–æ–Ω—ã)** | –°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è | –î–∞ (ROLLBACK —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ ‚Ññ1) | 3 –ø–æ–ø—ã—Ç–∫–∏ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π 500ms | –î–∞ (–¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∞–ª–≥–æ—Ä–∏—Ç–º) |
| **–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π Zone (4 —à—Ç—É–∫–∏)** | –°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è | –î–∞ (–≤ —Ç–æ–π –∂–µ –ë–î-—Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ ‚Ññ1) | –ù–µ—Ç | –î–∞ |
| **–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —É–Ω–∏–∫–∞–ª—å–Ω–æ–≥–æ request_id** | –°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è | –ù–µ—Ç (–¥–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≥–µ–Ω–µ—Ä–∞—Ü–∏—è) | N/A | –î–∞ (UUID v4 –∏–ª–∏ —Ñ–æ—Ä–º–∞—Ç REQ-YYYY-NNNN) |
| **–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –≤–æ–ª–æ–Ω—Ç—ë—Ä–æ–≤** | –°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è | –î–∞ (–æ—Ç–∫–∞—Ç —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ ‚Ññ2 –ø—Ä–∏ –∑–∞–Ω—è—Ç–æ—Å—Ç–∏) | –ù–µ—Ç (pessimistic locking) | –î–∞ |
| **–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–ø–∏—Å–∏ Group + –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤** | –°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è | –î–∞ (ROLLBACK —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ ‚Ññ2) | –ù–µ—Ç | –î–∞ (–ø—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–µ–π –ø–æ group_id) |
| **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ –≤–æ–ª–æ–Ω—Ç—ë—Ä–æ–≤ –Ω–∞ BUSY** | –°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è | –î–∞ (–≤ —Ç–æ–π –∂–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ ‚Ññ2) | –ù–µ—Ç | –î–∞ (optimistic locking —Å version) |
| **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –≥—Ä—É–ø–ø—ã –Ω–∞ –∑–æ–Ω—É (–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ zone)** | –°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è | –î–∞ (–≤ —Ç–æ–π –∂–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ ‚Ññ2) | –ù–µ—Ç | –î–∞ |
| **–ü—É–±–ª–∏–∫–∞—Ü–∏—è –¥–æ–º–µ–Ω–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π (RequestCreated, GroupFormed)** | –°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è (–≤ transactional outbox) | –î–∞ (–≤ —Ç–æ–π –∂–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏) | –ù–µ—Ç (—á–∞—Å—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏) | –î–∞ (–ø—Ä–æ–≤–µ—Ä–∫–∞ –¥—É–±–ª–µ–π –ø–æ event_id) |
| **–û—Ç–ø—Ä–∞–≤–∫–∞ SMS —Å—Ç–∞—Ä—à–µ–º—É –≥—Ä—É–ø–ø—ã** | –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è (—á–µ—Ä–µ–∑ –æ—á–µ—Ä–µ–¥—å) | –ù–µ—Ç (–≥—Ä—É–ø–ø–∞ —É–∂–µ —Å–æ–∑–¥–∞–Ω–∞) | 5 –ø–æ–ø—ã—Ç–æ–∫ —Å exponential backoff (1s, 2s, 4s, 8s, 16s) | –î–∞ (–¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ø–æ group_id + phone) |
| **–û—Ç–ø—Ä–∞–≤–∫–∞ push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –≤–æ–ª–æ–Ω—Ç—ë—Ä–∞–º** | –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è (—á–µ—Ä–µ–∑ –æ—á–µ—Ä–µ–¥—å) | –ù–µ—Ç | 5 –ø–æ–ø—ã—Ç–æ–∫ —Å exponential backoff | –î–∞ (–¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ø–æ group_id + user_id) |
| **–ó–∞–ø–∏—Å—å —Å–æ–±—ã—Ç–∏–π –≤ –∂—É—Ä–Ω–∞–ª —Å–æ–±—ã—Ç–∏–π (Events Log)** | –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è (event sourcing) | –ù–µ—Ç (best-effort) | 3 –ø–æ–ø—ã—Ç–∫–∏ | –î–∞ (–¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ø–æ event_id) |
| **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫—ç—à–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –æ—Ç—Ä—è–¥–∞ (Redis)** | –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è | –ù–µ—Ç (eventual consistency) | 3 –ø–æ–ø—ã—Ç–∫–∏ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π 1s | –î–∞ |


---

## 3. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–∫–∞–∑–æ–≤ –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

### 3.1. Notification Service –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω

**–ü—Ä–æ–±–ª–µ–º–∞:** –°–µ—Ä–≤–∏—Å SMS/Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç (—Ç–∞–π–º–∞—É—Ç, 503 Service Unavailable)

**–°—Ç—Ä–∞—Ç–µ–≥–∏—è:**
1. **–¢–∞–π–º–∞—É—Ç:** 10 —Å–µ–∫—É–Ω–¥ (–¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –≤—ã–∑–æ–≤–∞) –∏–ª–∏ N/A (–¥–ª—è async —á–µ—Ä–µ–∑ –æ—á–µ—Ä–µ–¥—å)
2. **–û—Å–Ω–æ–≤–Ω–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è:** –ù–ï –æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç—Å—è (–∑–∞—è–≤–∫–∞ –∏ –≥—Ä—É–ø–ø–∞ –æ—Å—Ç–∞—é—Ç—Å—è –≤ –ë–î)
3. **Retry:**
   - –ü–æ–º–µ—â–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ –æ—á–µ—Ä–µ–¥—å `notification_queue`
   - –§–æ–Ω–æ–≤—ã–π worker –ø—ã—Ç–∞–µ—Ç—Å—è –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ
   - Retry schedule: —á–µ—Ä–µ–∑ 1 –º–∏–Ω—É—Ç—É, –∑–∞—Ç–µ–º 5 –º–∏–Ω—É—Ç, 15 –º–∏–Ω—É—Ç, 1 —á–∞—Å, 6 —á–∞—Å–æ–≤
   - –ü–æ—Å–ª–µ 5 –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ ‚Üí –ø–æ–º–µ—á–∞–µ–º –∫–∞–∫ "failed" –∏ –∞–ª–µ—Ä—Ç–∏–º –∞–¥–º–∏–Ω–∞
   - –û—Ç–ø—Ä–∞–≤–ª—è–µ–º fallback-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä—É: "SMS –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞. –ü–æ–∑–≤–æ–Ω–∏ —Å—Ç–∞—Ä—à–µ–º—É –≤—Ä—É—á–Ω—É—é."
4. **–ö–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è:** –ù–µ—Ç (–≥—Ä—É–ø–ø–∞ —É–∂–µ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∞, —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ)
5. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:** "–ó–∞—è–≤–∫–∞ —Å–æ–∑–¥–∞–Ω–∞! –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –±—É–¥—É—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω—ã –ø–æ–∑–∂–µ. –ú–æ–∂–Ω–æ –ø–æ–∑–≤–æ–Ω–∏—Ç—å —Å—Ç–∞—Ä—à–µ–º—É –≤—Ä—É—á–Ω—É—é."

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:** –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è ‚Äî —ç—Ç–æ –ø—Ä–∏—è—Ç–Ω—ã–π –±–æ–Ω—É—Å, –Ω–æ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ. –°—Ç–∞—Ä—à–∏–π –≥—Ä—É–ø–ø—ã –≤—Å—ë —Ä–∞–≤–Ω–æ —É–≤–∏–¥–∏—Ç –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –≤ —Å–∏—Å—Ç–µ–º–µ, –∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä –º–æ–∂–µ—Ç –ø–æ–∑–≤–æ–Ω–∏—Ç—å –≤—Ä—É—á–Ω—É—é.

### 3.2. –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞

**–ü—Ä–æ–±–ª–µ–º–∞:** PostgreSQL –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç (connection refused, timeout)

**–°—Ç—Ä–∞—Ç–µ–≥–∏—è:**
1. **–¢–∞–π–º–∞—É—Ç:** 5 —Å–µ–∫—É–Ω–¥ –¥–ª—è connection, 30 —Å–µ–∫—É–Ω–¥ –¥–ª—è query
2. **–û—Å–Ω–æ–≤–Ω–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è:** ROLLBACK (–∑–∞—è–≤–∫–∞ –∏ –≥—Ä—É–ø–ø–∞ –ù–ï —Å–æ–∑–¥–∞—é—Ç—Å—è)
3. **Retry:**
   - –ù–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è: 3 –ø–æ–ø—ã—Ç–∫–∏ —Å —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π (1s, 2s, 4s)
   - –ï—Å–ª–∏ –≤—Å–µ 3 –ø–æ–ø—ã—Ç–∫–∏ –Ω–µ —É–¥–∞–ª–∏—Å—å ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ–º 503 Service Unavailable
4. **–ö–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è:** –ù–µ—Ç (–Ω–∏—á–µ–≥–æ –Ω–µ –±—ã–ª–æ —Å–æ–∑–¥–∞–Ω–æ)
5. **Offline-—Ä–µ–∂–∏–º:**
   - –ï—Å–ª–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä –≤ –ø–æ–ª–µ –±–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ ‚Üí —Å–æ—Ö—Ä–∞–Ω—è–µ–º –∑–∞—è–≤–∫—É –ª–æ–∫–∞–ª—å–Ω–æ (IndexedDB/SQLite)
   - –ü—Ä–∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–≤—è–∑–∏ ‚Üí —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ–º —Å —Å–µ—Ä–≤–µ—Ä–æ–º
6. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:** "–ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É. –ü–æ–ø—Ä–æ–±—É–π –µ—â—ë —Ä–∞–∑ –∏–ª–∏ —Å–≤—è–∂–∏—Å—å —Å —Ç–µ—Ö–ø–æ–¥–¥–µ—Ä–∂–∫–æ–π."

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:** –ë–î ‚Äî —ç—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç. –ë–µ–∑ –Ω–µ—ë –∑–∞—è–≤–∫–∞ –Ω–µ –º–æ–∂–µ—Ç —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å. –ù–æ –¥–ª—è –ø–æ–ª–µ–≤—ã—Ö —É—Å–ª–æ–≤–∏–π –Ω—É–∂–µ–Ω offline-—Ä–µ–∂–∏–º.

### 3.3. –°–µ—Ä–≤–∏—Å –≥–µ–æ–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω

**–ü—Ä–æ–±–ª–µ–º–∞:** –°–µ—Ä–≤–∏—Å —Ä–∞–∑–±–∏–µ–Ω–∏—è —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏ –Ω–∞ –∑–æ–Ω—ã –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç (–∏–ª–∏ –≤–µ—Ä–Ω—É–ª –æ—à–∏–±–∫—É)

**–°—Ç—Ä–∞—Ç–µ–≥–∏—è:**
1. **–¢–∞–π–º–∞—É—Ç:** 15 —Å–µ–∫—É–Ω–¥
2. **–û—Å–Ω–æ–≤–Ω–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è:** ROLLBACK (–∑–∞—è–≤–∫–∞ –ù–ï —Å–æ–∑–¥–∞—ë—Ç—Å—è –±–µ–∑ –∑–æ–Ω)
3. **Retry:**
   - 3 –ø–æ–ø—ã—Ç–∫–∏ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π 500ms
   - –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ–º 500 Internal Server Error
4. **–ö–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è:** –ù–µ—Ç (–∑–∞—è–≤–∫–∞ –±–µ–∑ –∑–æ–Ω –±–µ—Å–ø–æ–ª–µ–∑–Ω–∞)
5. **Fallback:**
   - –ü—Ä–µ–¥–ª–∞–≥–∞–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä—É —Å–æ–∑–¥–∞—Ç—å –∑–æ–Ω—ã –≤—Ä—É—á–Ω—É—é —á–µ—Ä–µ–∑ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∫–∞—Ä—Ç—ã
   - –°–æ—Ö—Ä–∞–Ω—è–µ–º –∑–∞—è–≤–∫—É –≤ —Å—Ç–∞—Ç—É—Å–µ "DRAFT" –¥–æ —Ä—É—á–Ω–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∑–æ–Ω
6. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:** "–ù–µ —É–¥–∞–ª–æ—Å—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–∑–±–∏—Ç—å —Ä–∞–π–æ–Ω –Ω–∞ –∑–æ–Ω—ã. –°–æ–∑–¥–∞–π –∑–æ–Ω—ã –≤—Ä—É—á–Ω—É—é –Ω–∞ –∫–∞—Ä—Ç–µ."

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:** –ó–æ–Ω—ã –∫—Ä–∏—Ç–∏—á–Ω—ã –¥–ª—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –ø–æ–∏—Å–∫–∞. –ï—Å–ª–∏ –∞–≤—Ç–æ–º–∞—Ç–∏–∫–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç ‚Äî –Ω—É–∂–µ–Ω —Ä—É—á–Ω–æ–π —Ä–µ–∂–∏–º.

### 3.4. –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–æ–≤ –≤–æ–ª–æ–Ω—Ç—ë—Ä–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞:** –î–≤–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ –ø—ã—Ç–∞—é—Ç—Å—è –Ω–∞–∑–Ω–∞—á–∏—Ç—å –æ–¥–Ω–æ–≥–æ –≤–æ–ª–æ–Ω—Ç—ë—Ä–∞

**–°—Ç—Ä–∞—Ç–µ–≥–∏—è:**
1. **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞:** –ò—Å–ø–æ–ª—å–∑—É–µ–º `SELECT ... FOR UPDATE` –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –≤–æ–ª–æ–Ω—Ç—ë—Ä–æ–≤
   ```sql
   SELECT * FROM volunteers 
   WHERE id IN (1, 2, 3) AND status = 'AVAILABLE'
   FOR UPDATE;
   ```
2. **–û—Å–Ω–æ–≤–Ω–∞—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è ‚Ññ2:** ROLLBACK (–≥—Ä—É–ø–ø–∞ –ù–ï —Å–æ–∑–¥–∞—ë—Ç—Å—è)
3. **Retry:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ–º —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –≤–æ–ª–æ–Ω—Ç—ë—Ä–æ–≤ –∏ –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä—É –≤—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥–∏—Ö
4. **–ö–æ–º–ø–µ–Ω—Å–∞—Ü–∏—è:** –ó–∞—è–≤–∫–∞ –æ—Å—Ç–∞—ë—Ç—Å—è –≤ —Å—Ç–∞—Ç—É—Å–µ "NEW" (–æ—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è ‚Ññ2)
5. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:** "–í–æ–ª–æ–Ω—Ç—ë—Ä—ã —É–∂–µ –∑–∞–Ω—è—Ç—ã. –ü–æ–ø—Ä–æ–±—É–π –≤—ã–±—Ä–∞—Ç—å –¥—Ä—É–≥–∏—Ö."

**–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ:** Pessimistic locking –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç race condition. –≠—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è "–¥–≤–æ–π–Ω–æ–≥–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è" –≤–æ–ª–æ–Ω—Ç—ë—Ä–æ–≤.

---

## 4. –ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å

### 4.1. –ü—Ä–æ–±–ª–µ–º–∞: –ü–æ–≤—Ç–æ—Ä–Ω–æ–µ –Ω–∞–∂–∞—Ç–∏–µ –∫–Ω–æ–ø–∫–∏ "–°–æ–∑–¥–∞—Ç—å –∑–∞—è–≤–∫—É"

**–°—Ü–µ–Ω–∞—Ä–∏–π:** –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä –¥–≤–∞–∂–¥—ã –∫–ª–∏–∫–Ω—É–ª –Ω–∞ –∫–Ω–æ–ø–∫—É –∏–∑-–∑–∞ –º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ –≤ –ø–æ–ª–µ–≤—ã—Ö —É—Å–ª–æ–≤–∏—è—Ö

**–†–µ—à–µ–Ω–∏–µ:**
1. **Frontend:** –ë–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∫–Ω–æ–ø–∫—É –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –∫–ª–∏–∫–∞ (disable button)
2. **Backend:** –ü—Ä–æ–≤–µ—Ä—è—Ç—å `idempotency_key` –≤ –∑–∞–ø—Ä–æ—Å–µ
   ```json
   {
     "missing_person_name": "–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤",
     "coordinates": {"lat": 53.9045, "lon": 27.5615},
     "radius_km": 5,
     "idempotency_key": "coord-789_2024-11-08_09-00-15"
   }
   ```
3. **–õ–æ–≥–∏–∫–∞:**
   - –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∑–∞–ø—Ä–æ—Å–∞ –ø—Ä–æ–≤–µ—Ä—è–µ–º —Ç–∞–±–ª–∏—Ü—É `idempotent_requests`
   - –ï—Å–ª–∏ `idempotency_key` —É–∂–µ –µ—Å—Ç—å ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç (request_id, group_id)
   - –ï—Å–ª–∏ –Ω–µ—Ç ‚Üí –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –∑–∞–ø—Ä–æ—Å –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º –≤ `idempotent_requests`
4. **TTL –∫–ª—é—á–µ–π:** 24 —á–∞—Å–∞ (–ø–æ—Å–ª–µ —ç—Ç–æ–≥–æ –º–æ–∂–Ω–æ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å —Å–æ–∑–¥–∞–Ω–∏–µ —Å —Ç–µ–º –∂–µ –∫–ª—é—á–æ–º)

**–ü—Ä–∏–º–µ—Ä —Ç–∞–±–ª–∏—Ü—ã:**
```sql
CREATE TABLE idempotent_requests (
  idempotency_key VARCHAR(128) PRIMARY KEY,
  endpoint VARCHAR(255) NOT NULL,
  response_body JSONB NOT NULL,
  created_at TIMESTAMP DEFAULT NOW()
);

CREATE INDEX idx_idempotent_created ON idempotent_requests(created_at);
-- –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –∑–∞–ø–∏—Å–µ–π –ø–æ cron (—Å—Ç–∞—Ä—à–µ 24 —á–∞—Å–æ–≤)
```

### 4.2. –ü—Ä–æ–±–ª–µ–º–∞: –î—É–±–ª–∏–∫–∞—Ç—ã SMS-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

**–°—Ü–µ–Ω–∞—Ä–∏–π:** Notification Service –ø–æ–ª—É—á–∏–ª –∑–∞–ø—Ä–æ—Å –¥–≤–∞–∂–¥—ã –∏–∑-–∑–∞ retry

**–†–µ—à–µ–Ω–∏–µ:**
1. –í —Ç–∞–±–ª–∏—Ü–µ `notification_queue` –¥–æ–±–∞–≤–ª—è–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∫–ª—é—á:
   ```sql
   CREATE UNIQUE INDEX idx_notification_dedup 
   ON notification_queue(request_id, group_id, recipient_phone, notification_type);
   ```
2. –ü—Ä–∏ –ø–æ–ø—ã—Ç–∫–µ –¥–æ–±–∞–≤–∏—Ç—å –¥—É–±–ª–∏–∫–∞—Ç ‚Üí –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º (ON CONFLICT DO NOTHING)
3. SMS-–ø—Ä–æ–≤–∞–π–¥–µ—Ä —Ç–∞–∫–∂–µ –¥–æ–ª–∂–µ–Ω –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—Ç—å –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—é —á–µ—Ä–µ–∑ `Message-ID`

### 4.3. –ü—Ä–æ–±–ª–µ–º–∞: –ü–æ–≤—Ç–æ—Ä–Ω–æ–µ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã –¥–ª—è —Ç–æ–π –∂–µ –∑–∞—è–≤–∫–∏

**–°—Ü–µ–Ω–∞—Ä–∏–π:** –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä –¥–≤–∞–∂–¥—ã –Ω–∞–∂–∞–ª "–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –≥—Ä—É–ø–ø—É"

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ –≥—Ä—É–ø–ø–∞ –¥–ª—è —ç—Ç–æ–π –∑–∞—è–≤–∫–∏ –∏ –∑–æ–Ω—ã:
   ```sql
   SELECT * FROM groups 
   WHERE request_id = 'REQ-2024-0142' AND assigned_zone_id = 'Z-001';
   ```
2. –ï—Å–ª–∏ –≥—Ä—É–ø–ø–∞ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –µ—ë ID (–Ω–µ —Å–æ–∑–¥–∞—ë–º –Ω–æ–≤—É—é)
3. –ï—Å–ª–∏ —Å—Ç–∞—Ç—É—Å –≥—Ä—É–ø–ø—ã `FORMING` –∏–ª–∏ `ACTIVE` ‚Üí –∑–∞–ø—Ä–µ—â–∞–µ–º —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–π
4. –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ: "–ì—Ä—É–ø–ø–∞ –¥–ª—è —ç—Ç–æ–π –∑–æ–Ω—ã —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç. ID: G-42"

---

## 5. –î–∏–∞–≥—Ä–∞–º–º–∞ –ø–æ—Ç–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Coordinator   ‚îÇ
‚îÇ   (Client)     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îÇ 1. POST /api/requests
        ‚îÇ    + idempotency_key
        ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ   API Gateway         ‚îÇ
‚îÇ  (Rate Limiting,      ‚îÇ
‚îÇ   Authentication,     ‚îÇ
‚îÇ   Offline-sync)       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îÇ 2. Forward request
        ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Request Service      ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ (Application Layer)   ‚îÇ      ‚îÇ 3. BEGIN TRANSACTION ‚Ññ1
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îÇ
        ‚îÇ 4. Validate data     ‚îÇ
        ‚îÇ   (coords, radius)   ‚îÇ
        ‚ñº                       ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îÇ
‚îÇ  Domain Model         ‚îÇ      ‚îÇ
‚îÇ (Business Logic)      ‚îÇ      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îÇ
        ‚îÇ 5. Create Request    ‚îÇ
        ‚îÇ    aggregate         ‚îÇ
        ‚ñº                       ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îÇ
‚îÇ  Geo Planning Service ‚îÇ      ‚îÇ
‚îÇ  (Zone Split)         ‚îÇ      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îÇ
        ‚îÇ 6. Split into zones  ‚îÇ
        ‚ñº                       ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îÇ
‚îÇ  PostgreSQL           ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‚îÇ  (Write Model)        ‚îÇ      7. COMMIT TRANSACTION ‚Ññ1
‚îÇ  tables: requests,    ‚îÇ
‚îÇ          zones        ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îÇ 8. Request created
        ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Group Service        ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ (Application Layer)   ‚îÇ      ‚îÇ 9. BEGIN TRANSACTION ‚Ññ2
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îÇ
        ‚îÇ 10. Check volunteers ‚îÇ
        ‚îÇ     availability     ‚îÇ
        ‚ñº                       ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îÇ
‚îÇ  PostgreSQL           ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò SELECT ... FOR UPDATE
‚îÇ  (Pessimistic Lock)   ‚îÇ      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îÇ
        ‚îÇ 11. Create Group     ‚îÇ
        ‚îÇ     + assign zone    ‚îÇ
        ‚ñº                       ‚îÇ
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îÇ
‚îÇ  PostgreSQL           ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‚îÇ  tables: groups,      ‚îÇ      12. COMMIT TRANSACTION ‚Ññ2
‚îÇ          group_members‚îÇ
‚îÇ          zones (update)‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îÇ 13. Publish Events
        ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Event Bus            ‚îÇ
‚îÇ  (RabbitMQ/Kafka)     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îÇ
        ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ                      ‚îÇ
        ‚ñº                      ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Notification ‚îÇ      ‚îÇ  Events Log  ‚îÇ
‚îÇ   Worker     ‚îÇ      ‚îÇ   Worker     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
       ‚îÇ
       ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
       ‚îÇ          ‚îÇ          ‚îÇ
       ‚ñº          ‚ñº          ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇSMS Service‚îÇ ‚îÇPush Srv ‚îÇ ‚îÇEmail Srv   ‚îÇ
‚îÇ (Twilio) ‚îÇ ‚îÇ(Firebase)‚îÇ ‚îÇ(SendGrid)  ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## 6. –ú–µ—Ç—Ä–∏–∫–∏ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

**–ö–ª—é—á–µ–≤—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è:**

| –ú–µ—Ç—Ä–∏–∫–∞ | –¶–µ–ª—å | –ê–ª–µ—Ä—Ç –ø—Ä–∏ |
|---------|------|-----------|
| `request_creation_latency_p95` | < 3 —Å–µ–∫—É–Ω–¥—ã | > 5 —Å–µ–∫—É–Ω–¥ |
| `request_creation_success_rate` | > 99% | < 98% |
| `group_formation_latency_p95` | < 5 —Å–µ–∫—É–Ω–¥ | > 10 —Å–µ–∫—É–Ω–¥ |
| `group_formation_success_rate` | > 98% | < 95% |
| `db_connection_pool_active` | < 80% –æ—Ç –º–∞–∫—Å. | > 90% |
| `notification_queue_size` | < 500 | > 2000 |
| `sms_delivery_rate` | > 95% –≤ —Ç–µ—á–µ–Ω–∏–µ 5 –º–∏–Ω—É—Ç | < 90% |
| `push_delivery_rate` | > 98% –≤ —Ç–µ—á–µ–Ω–∏–µ 1 –º–∏–Ω—É—Ç—ã | < 95% |
| `volunteer_lock_timeout_count` | 0 | > 10/hour |
| `geo_service_timeout_count` | 0 | > 5/hour |
| `concurrent_volunteer_conflicts` | < 5/hour | > 20/hour |
| `offline_sync_pending_count` | 0 | > 50 |

**–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- **INFO:** –£—Å–ø–µ—à–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏ –∏ –≥—Ä—É–ø–ø—ã
- **WARNING:** Notification Service timeout, –ø–æ–º–µ—Å—Ç–∏–ª–∏ –≤ –æ—á–µ—Ä–µ–¥—å
- **WARNING:** –í–æ–ª–æ–Ω—Ç—ë—Ä —É–∂–µ –∑–∞–Ω—è—Ç, –æ—Ç–∫–∞—Ç–∏–ª–∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã
- **ERROR:** –ë–î –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞, –æ—Ç–∫–∞—Ç–∏–ª–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
- **ERROR:** Geo Planning Service –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –Ω–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –∑–æ–Ω—ã
- **CRITICAL:** –û—á–µ—Ä–µ–¥—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∞ (> 5000)
- **CRITICAL:** –ë–æ–ª–µ–µ 20% –∑–∞—è–≤–æ–∫ –Ω–µ –º–æ–≥—É—Ç —Å–æ–∑–¥–∞—Ç—å –≥—Ä—É–ø–ø—ã –∏–∑-–∑–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –≤–æ–ª–æ–Ω—Ç—ë—Ä–æ–≤

---

## 7. –í—ã–≤–æ–¥—ã

### –ö–ª—é—á–µ–≤—ã–µ —Ä–µ—à–µ–Ω–∏—è:

1. ‚úÖ **–î–≤–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏:** –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞—è–≤–∫–∏ (Tx1) –∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã (Tx2) ‚Äî —Ä–∞–∑–¥–µ–ª–µ–Ω—ã –¥–ª—è –≥–∏–±–∫–æ—Å—Ç–∏
2. ‚úÖ **–ê—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å:** –ó–∞—è–≤–∫–∞ + –∑–æ–Ω—ã –≤ –æ–¥–Ω–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏; –ì—Ä—É–ø–ø–∞ + –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ –∑–æ–Ω—ã –≤ –¥—Ä—É–≥–æ–π
3. ‚úÖ **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å:** SMS/Push-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∏ –∑–∞–ø–∏—Å—å —Å–æ–±—ã—Ç–∏–π ‚Äî —á–µ—Ä–µ–∑ –æ—á–µ—Ä–µ–¥—å
4. ‚úÖ **–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å:** –ò—Å–ø–æ–ª—å–∑—É–µ–º `idempotency_key` –¥–ª—è –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
5. ‚úÖ **Pessimistic Locking:** `SELECT ... FOR UPDATE` –¥–ª—è –∏–∑–±–µ–∂–∞–Ω–∏—è –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ–≥–æ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –≤–æ–ª–æ–Ω—Ç—ë—Ä–æ–≤
6. ‚úÖ **–û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å:** –ù–µ –æ—Ç–∫–∞—Ç—ã–≤–∞–µ–º –∑–∞—è–≤–∫—É –ø—Ä–∏ —Å–±–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π; Offline-—Ä–µ–∂–∏–º –¥–ª—è –ø–æ–ª–µ–≤—ã—Ö —É—Å–ª–æ–≤–∏–π
7. ‚úÖ **Retry:** Exponential backoff –¥–ª—è –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–±–æ–µ–≤ (SMS, Push, Geo Service)
8. ‚úÖ **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:** –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫—Ä–∏—Ç–∏—á–Ω–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ + –∞–ª–µ—Ä—Ç—ã
9. ‚úÖ **Eventual Consistency:** –°–æ–±—ã—Ç–∏—è –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ —á–µ—Ä–µ–∑ event sourcing

### –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—ã–µ –∏–Ω–≤–∞—Ä–∏–∞–Ω—Ç—ã:

- **–ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç ‚Ññ1:** –ó–∞—è–≤–∫–∞ –±–µ–∑ –∑–æ–Ω –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–∞ ‚Üí –æ—Ç–∫–∞—Ç—ã–≤–∞–µ–º Tx1
- **–ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç ‚Ññ2:** –ì—Ä—É–ø–ø–∞ –Ω–µ –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∑–∞–Ω—è—Ç—ã—Ö –≤–æ–ª–æ–Ω—Ç—ë—Ä–æ–≤ ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ–º pessimistic lock
- **–ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç ‚Ññ3:** –ó–æ–Ω–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–∞–∑–Ω–∞—á–µ–Ω–∞ —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ–π –≥—Ä—É–ø–ø–µ ‚Üí unique constraint –Ω–∞ `zones.assigned_group_id`
- **–ò–Ω–≤–∞—Ä–∏–∞–Ω—Ç ‚Ññ4:** –í–æ–ª–æ–Ω—Ç—ë—Ä –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ –¥–≤—É—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö –≥—Ä—É–ø–ø–∞—Ö –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ ‚Üí –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ + version –¥–ª—è optimistic locking


### –ö–æ–º–ø—Ä–æ–º–∏—Å—Å—ã:

- **Eventual consistency –¥–ª—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:** –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å email —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π, –Ω–æ —ç—Ç–æ –ø—Ä–∏–µ–º–ª–µ–º–æ
- **–°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è:** –ó–∞–º–µ–¥–ª—è–µ—Ç —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏, –Ω–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö
- **–•—Ä–∞–Ω–µ–Ω–∏–µ idempotency keys 24 —á–∞—Å–∞:** –ó–∞–Ω–∏–º–∞–µ—Ç –º–µ—Å—Ç–æ –≤ –ë–î, –Ω–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç—ã

### –†–∏—Å–∫–∏:

‚ö†Ô∏è **–†–∏—Å–∫ 1:** –û—á–µ—Ä–µ–¥—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –º–æ–∂–µ—Ç –ø–µ—Ä–µ–ø–æ–ª–Ω–∏—Ç—å—Å—è –ø—Ä–∏ –º–∞—Å—Å–æ–≤–æ–º —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–¥–∞—á
- **–ú–∏—Ç–∏–≥–∞—Ü–∏—è:** –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ª–∏–º–∏—Ç –æ—á–µ—Ä–µ–¥–∏ + –∞–ª–µ—Ä—Ç –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ 5000 —Å–æ–æ–±—â–µ–Ω–∏–π

‚ö†Ô∏è **–†–∏—Å–∫ 2:** Race condition –ø—Ä–∏ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–º –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–∏ –∑–∞–¥–∞—á –æ–¥–Ω–æ–º—É –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—é –º–æ–∂–µ—Ç –ø—Ä–µ–≤—ã—Å–∏—Ç—å –µ–≥–æ –ª–∏–º–∏—Ç
- **–ú–∏—Ç–∏–≥–∞—Ü–∏—è:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å SELECT FOR UPDATE –ø—Ä–∏ –ø—Ä–æ–≤–µ—Ä–∫–µ –ª–∏–º–∏—Ç–∞ –∑–∞–¥–∞—á –Ω–∞ –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è
